<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>SignalR Chat - Metanit.com</title>
    <style>
        td {
            width: 30px;
            height: 30px;
        }

        button {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<header id="game_status">
    Waiting other
</header>

<table id="self_holder"></table>

<table id="other_holder"></table>

<script src="lib/signalr/signalr.js"></script>
<script>

    const hubConnection = new signalR.HubConnectionBuilder()
        .withUrl("/hub")
        .build();
    
    function generate(holder, clickFunction){
        var table = document.getElementById(holder); 
        var rowButtonNumber = 10;
        var buttonNumber = 100;
        
        for (var i = 0; i < buttonNumber; i++) {
            var tr = document.createElement("tr");
            table.appendChild(tr);
            
            for (var j = 0; j < rowButtonNumber; j++, i++) {
                var td = document.createElement("td");
                var btn = document.createElement("button");
                btn.innerHTML = "+";
                btn.id = i;
                btn.onclick = clickFunction;
                if (i >= buttonNumber) {
                    break;
                } else {
                    td.appendChild(btn);
                    tr.appendChild(td);
                }
            }
            i--;
        }
    }
    
    //generate();
    // TODO: добавить горизональное расположение
    
    hubConnection.on("LoadGame", () => {
        let statusElement = document.getElementById("game_status");
        statusElement.textContent = "Gaming";
        
        alert("GameStarted, select ship place");
        
        generate("self_holder", function ()
        {
            hubConnection.invoke("Place", {
                CellIndex: parseInt(this.id),
                Type: 4,
                IsVertical: true
            });
        });
    });
    
    hubConnection.on("UpdateSelfField", function(view) 
    {
        const tableElement = document.querySelector('#self_holder');
        
        var i = 0;
        
        view['self'].forEach(cell => {
            var view = "";
            
            switch (cell) {
                case 0:
                    view = "+";
                    break;
                    
                case 1:
                    view = "O";
                    break;

                case 2:
                    view = "X";
                    break;

                case 3:
                    view = "W";
                    break;
                    
                default:
                    break;
            }

            tableElement.querySelector("[id='" + i + "']")
                .textContent = view
            
            i = ++i;
        });
    });

    hubConnection.start();
</script>
</body>